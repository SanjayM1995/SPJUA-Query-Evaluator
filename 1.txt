CREATE TABLE CUSTOMER (C_CUSTKEY INTEGER, C_NAME STRING, C_ADDRESS STRING, C_NATIONKEY INTEGER, C_PHONE STRING, C_ACCTBAL DOUBLE, C_MKTSEGMENT STRING, C_COMMENT STRING);


CREATE TABLE NATION(N_NATIONKEY INTEGER, N_NAME STRING, N_REGIONKEY INTEGER, N_COMMENT STRING);


CREATE TABLE REGION(R_REGIONKEY INTEGER, R_NAME STRING, R_COMMENT STRING);


CREATE TABLE PLAYERS ( ID STRING, FIRSTNAME STRING, LASTNAME STRING, FIRSTSEASON INTEGER, LASTSEASON INTEGER, WEIGHT INTEGER, BIRTHDATE DATE);


CREATE TABLE ORDERS (O_ORDERKEY INTEGER, O_CUSTKEY INTEGER, O_ORDERSTATUS STRING, O_TOTALPRICE DOUBLE, O_ORDERDATE DATE, O_ORDERPRIORITY STRING, O_CLERK STRING, O_SHIPPRIORITY INTEGER, O_COMMENT STRING);


CREATE TABLE LINEITEM (L_ORDERKEY INTEGER, L_PARTKEY INTEGER, L_SUPPKEY INTEGER, L_LINENUMBER INTEGER, L_QUANTITY DOUBLE, L_EXTENDEDPRICE DOUBLE, L_DISCOUNT DOUBLE, L_TAX DOUBLE, L_RETURNFLAG STRING, L_LINESTATUS STRING, L_SHIPDATE DATE, L_COMMITDATE DATE, L_RECEIPTDATE DATE, L_SHIPINSTRUCT STRING, L_SHIPMODE STRING, L_COMMENT STRING);

SELECT LINEITEM.L_ORDERKEY ,
       SUM(LINEITEM.L_EXTENDEDPRICE*(1-LINEITEM.L_DISCOUNT)) AS REVENUE ,
       ORDERS.O_ORDERDATE ,
       ORDERS.O_SHIPPRIORITY
FROM CUSTOMER ,
     ORDERS ,
     LINEITEM
WHERE CUSTOMER.C_MKTSEGMENT = 'BUILDING'
  AND CUSTOMER.C_CUSTKEY = ORDERS.O_CUSTKEY
  AND LINEITEM.L_ORDERKEY = ORDERS.O_ORDERKEY
  AND ( LINEITEM.L_DISCOUNT < .06
       OR LINEITEM.L_QUANTITY < 24 )
GROUP BY ORDERS.O_ORDERDATE ,
         ORDERS.O_SHIPPRIORITY ,
         LINEITEM.L_ORDERKEY
ORDER BY REVENUE DESC ,
         ORDERS.O_ORDERDATE ;


SELECT L_LINESTATUS ,
       O_ORDERKEY ,
       SUM(L_QUANTITY) AS SUM_QTY ,
       SUM(L_EXTENDEDPRICE) AS SUM_BASE_PRICE ,
       SUM(L_EXTENDEDPRICE*(1-L_DISCOUNT)) AS SUM_DISC_PRICE ,
       SUM(L_EXTENDEDPRICE*(1-L_DISCOUNT)*(1+L_TAX)) AS SUM_CHARGE ,
       AVG(L_QUANTITY) AS AVG_QTY ,
       AVG(L_EXTENDEDPRICE) AS AVG_PRICE ,
       AVG(L_DISCOUNT) AS AVG_DISC
FROM LINEITEM ,
     ORDERS
GROUP BY L_LINESTATUS ,
         O_ORDERKEY
ORDER BY L_LINESTATUS ;
