CREATE TABLE CUSTOMER (C_CUSTKEY INTEGER, C_NAME STRING, C_ADDRESS STRING, C_NATIONKEY INTEGER, C_PHONE STRING, C_ACCTBAL DOUBLE, C_MKTSEGMENT STRING, C_COMMENT STRING);
CREATE TABLE NATION(N_NATIONKEY INTEGER, N_NAME STRING, N_REGIONKEY INTEGER, N_COMMENT STRING);
CREATE TABLE REGION(R_REGIONKEY INTEGER, R_NAME STRING, R_COMMENT STRING);
CREATE TABLE PLAYERS (
	ID STRING,
	FIRSTNAME STRING,
	LASTNAME STRING,
	FIRSTSEASON INTEGER,
	LASTSEASON INTEGER,
	WEIGHT INTEGER,
	BIRTHDATE DATE
);

CREATE TABLE ORDERS (O_ORDERKEY INTEGER, O_CUSTKEY INTEGER, O_ORDERSTATUS STRING, O_TOTALPRICE DOUBLE, O_ORDERDATE DATE, O_ORDERPRIORITY STRING, O_CLERK STRING, O_SHIPPRIORITY INTEGER, O_COMMENT STRING);

CREATE TABLE LINEITEM (L_ORDERKEY INTEGER, L_PARTKEY INTEGER, L_SUPPKEY INTEGER, L_LINENUMBER INTEGER, L_QUANTITY DOUBLE, L_EXTENDEDPRICE DOUBLE, L_DISCOUNT DOUBLE, L_TAX DOUBLE, L_RETURNFLAG STRING, L_LINESTATUS STRING, L_SHIPDATE DATE, L_COMMITDATE DATE, L_RECEIPTDATE DATE, L_SHIPINSTRUCT STRING, L_SHIPMODE STRING, L_COMMENT STRING);

SELECT CUSTOMER.C_CUSTKEY,
       SUM(LINEITEM.L_EXTENDEDPRICE * (1 + LINEITEM.L_DISCOUNT)) AS REVENUE,
       CUSTOMER.C_ACCTBAL
FROM CUSTOMER,
     ORDERS,
     LINEITEM,
     NATION
WHERE CUSTOMER.C_CUSTKEY = ORDERS.O_CUSTKEY
  AND (LINEITEM.L_DISCOUNT < .06
       OR LINEITEM.L_QUANTITY < 24)
  AND LINEITEM.L_ORDERKEY = ORDERS.O_ORDERKEY
  AND LINEITEM.L_RETURNFLAG = 'R'
  AND CUSTOMER.C_NATIONKEY = NATION.N_NATIONKEY
GROUP BY CUSTOMER.C_CUSTKEY,
         CUSTOMER.C_ACCTBAL
ORDER BY REVENUE ASC LIMIT 20;