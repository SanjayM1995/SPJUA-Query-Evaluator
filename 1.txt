CREATE TABLE CUSTOMER (
	C_CUSTKEY		INTEGER PRIMARY KEY,
	C_NAME			STRING,
	C_ADDRESS		STRING,
	C_NATIONKEY		INTEGER REFERENCES NATION,
	C_PHONE			STRING,
	C_ACCTBAL		DOUBLE,
	C_MKTSEGMENT	STRING,
	C_COMMENT		STRING
);


CREATE TABLE ORDERS (
	O_ORDERKEY		INTEGER PRIMARY KEY,
	O_CUSTKEY		INTEGER REFERENCES CUSTOMER,
	O_ORDERSTATUS	STRING,
	O_TOTALPRICE	DOUBLE,
	O_ORDERDATE		DATE,
	O_ORDERPRIORITY	STRING,
	O_CLERK			STRING,
	O_SHIPPRIORITY	INTEGER,
	O_COMMENT		STRING
);


CREATE TABLE LINEITEM (
	L_ORDERKEY		INTEGER REFERENCES ORDERS,
	L_PARTKEY		INTEGER REFERENCES PART,
	L_SUPPKEY		INTEGER REFERENCES SUPPLIER,
	L_LINENUMBER	INTEGER,
	L_QUANTITY		DOUBLE,
	L_EXTENDEDPRICE	DOUBLE,
	L_DISCOUNT		DOUBLE,
	L_TAX			DOUBLE,
	L_RETURNFLAG	STRING,
	L_LINESTATUS	STRING,
	L_SHIPDATE		DATE,
	L_COMMITDATE	DATE,
	L_RECEIPTDATE	DATE,
	L_SHIPINSTRUCT	STRING,
	L_SHIPMODE		STRING,
	L_COMMENT		STRING,
	PRIMARY KEY (L_ORDERKEY, L_LINENUMBER)
);

CREATE TABLE NATION (
	N_NATIONKEY		INTEGER PRIMARY KEY,
	N_NAME			STRING,
	N_REGIONKEY		INTEGER REFERENCES REGION,
	N_COMMENT		STRING
);

CREATE TABLE REGION (
	R_REGIONKEY	INTEGER PRIMARY KEY,
	R_NAME		STRING,
	R_COMMENT	STRING
);
CREATE TABLE PART (
	P_PARTKEY		INTEGER PRIMARY KEY,
	P_NAME			STRING,
	P_MFGR			STRING,
	P_BRAND			STRING,
	P_TYPE			STRING,
	P_SIZE			INTEGER,
	P_CONTAINER		STRING,
	P_RETAILPRICE	DOUBLE,N
	P_COMMENT		STRING
);


SELECT LINEITEM.L_ORDERKEY, SUM(LINEITEM.L_EXTENDEDPRICE*(1-LINEITEM.L_DISCOUNT)) AS REVENUE, ORDERS.O_ORDERDATE, ORDERS.O_SHIPPRIORITY
FROM CUSTOMER, ORDERS, LINEITEM
WHERE CUSTOMER.C_MKTSEGMENT = 'BUILDING'
AND CUSTOMER.C_CUSTKEY = ORDERS.O_CUSTKEY AND LINEITEM.L_ORDERKEY = ORDERS.O_ORDERKEY
AND (LINEITEM.L_DISCOUNT < 0.08 OR LINEITEM.L_QUANTITY < 34)
GROUP BY ORDERS.O_ORDERDATE, ORDERS.O_SHIPPRIORITY, LINEITEM.L_ORDERKEY
ORDER BY REVENUE DESC, ORDERS.O_ORDERDATE
LIMIT 100;












